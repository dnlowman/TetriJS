var createRectangle=function(t,e,a,i){"use strict";var o=new PIXI.Graphics;return o.position.x=20*t,o.position.y=20*e,o.beginFill("undefined"==typeof a?16776960:a),o.lineStyle(1,"undefined"==typeof i?16777215:i),o.drawRect(0,0,20,20),stage.addChild(o),o},Point=function(t,e){this.x=t,this.y=e},Shape=function(t){this.game=t,this.sprites=[],this.landed=!1,this.points=[],this.originalShape=[],this.positionX=0,this.positionY=0,this.drawStartX=0,this.drawStartY=0,this.color=1};Shape.prototype.arePointsLegal=function(t){var e=this;try{t.forEach(function(t){if(t.x<0||t.x>=e.game.gameWidth||t.y<0||t.y>=e.game.gameHeight)throw"Point out of bounds";if(t.x>=0&&t.x<e.game.gameWidth&&t.y>=0&&t.y<e.game.gameHeight&&1==e.game.gameGrid[t.x][t.y])throw"Point collides with another shape"})}catch(a){return!1}return!0},Shape.prototype.rotatePoints=function(){var t=[],e=this;return this.points.forEach(function(a){var i=[[0,-1],[1,0]],o=a.x-e.positionX,r=a.y-e.positionY,h=o*i[0][0]+r*i[0][1],n=o*i[1][0]+r*i[1][1];h+=e.positionX,n+=e.positionY,t.push(new Point(h,n))}),t},Shape.prototype.rotateShape=function(){var t=this.rotatePoints();return 0==this.arePointsLegal(t)?!1:(this.points=t,!0)},Shape.prototype.incrementShapePosition=function(t,e){if(1!=this.landed){var a=this.positionX,i=this.positionY,o=[];this.points.forEach(function(t){o.push(new Point(t.x,t.y))});var r=this,h=!1,n=!1;a+=t,i+=e;try{o.forEach(function(a){a.x+=t,a.y+=e}),o.forEach(function(t){if(t.y<0||t.y>r.game.gameHeight-1)throw"Y Out of bounds";if(t.x<0||t.x>r.game.gameWidth-1)throw h=!0,"X Out of bounds";if(t.x>=0&&t.x<r.game.gameWidth&&t.y>=0&&t.y<r.game.gameHeight&&1==r.game.gameGrid[t.x][t.y])throw"Point collides with another shape"})}catch(s){("Y Out of bounds"==s||"Point collides with another shape"==s)&&(0===t?(this.landed=!0,this.game.onShapeLanded(),FRAME_INTERVAL=1e3):n=!0)}0==this.landed&&0==h&&0==n&&(this.positionX=a,this.positionY=i,this.points.length=0,o.forEach(function(t){r.points.push(new Point(t.x,t.y))}))}};var TShape=function(t){Shape.call(this,t),this.originalShape=[[!0,!0,!0],[!1,!0,!1]],this.positionX=4,this.positionY=0,this.drawStartX=3,this.drawStartY=0,this.color=10420464};TShape.prototype=Object.create(Shape.prototype),TShape.prototype.constructor=TShape;var OShape=function(t){Shape.call(this,t),this.originalShape=[[!0,!0],[!0,!0]],this.positionX=4,this.positionY=0,this.drawStartX=4,this.drawStartY=0,this.color=39321};OShape.prototype=Object.create(Shape.prototype),OShape.prototype.constructor=OShape,OShape.prototype.rotateShape=function(){return!1};var IShape=function(t){Shape.call(this,t),this.originalShape=[[!0,!0,!0,!0]],this.positionX=4,this.positionY=0,this.drawStartX=3,this.drawStartY=0,this.color=5366268};IShape.prototype=Object.create(Shape.prototype),IShape.prototype.constructor=IShape;var SShape=function(t){Shape.call(this,t),this.originalShape=[[!1,!0,!0],[!0,!0,!1]],this.positionX=4,this.positionY=0,this.drawStartX=3,this.drawStartY=0,this.color=15285534};SShape.prototype=Object.create(Shape.prototype),SShape.prototype.constructor=SShape;var ZShape=function(t){Shape.call(this,t),this.originalShape=[[!0,!0,!1],[!1,!0,!0]],this.positionX=4,this.positionY=0,this.drawStartX=3,this.drawStartY=0,this.color=65280};ZShape.prototype=Object.create(Shape.prototype),ZShape.prototype.constructor=ZShape;var LShape=function(t){Shape.call(this,t),this.originalShape=[[!0,!0,!0],[!0,!1,!1]],this.positionX=4,this.positionY=0,this.drawStartX=3,this.drawStartY=0,this.color=255};LShape.prototype=Object.create(Shape.prototype),LShape.prototype.constructor=LShape;var JShape=function(t){Shape.call(this,t),this.originalShape=[[!0,!0,!0],[!1,!1,!0]],this.positionX=4,this.positionY=0,this.drawStartX=3,this.drawStartY=0,this.color=15822521};JShape.prototype=Object.create(Shape.prototype),JShape.prototype.constructor=JShape;var GameObject=function(t,e){this.shapes=[],this.currentShape=null,this.gameWidth=t,this.gameHeight=e,this.gameGrid=[t],this.landedShapeSprites=[e],this.landedShapeSpritesColors=[e];for(var a=0;e>a;++a)this.gameGrid[a]=[t],this.landedShapeSprites[a]=[t],this.landedShapeSpritesColors[a]=[t]};GameObject.prototype.initGameGrid=function(){for(var t=0;t<this.gameHeight;++t)for(var e=0;e<this.gameWidth;++e)this.gameGrid[e][t]=!1,stage.addChild(createRectangle(e,t,0,0))},GameObject.prototype.addShape=function(t){for(var e=0;e<t.originalShape.length;++e)for(var a=0;a<t.originalShape[0].length;++a)if(t.originalShape[e][a]===!0){var i=t.drawStartY+e,o=t.drawStartX+a;t.points.push(new Point(o,i))}t.arePointsLegal(t.points)===!0?this.currentShape=t:console.log("Game over!")},GameObject.prototype.renderShapes=function(){var t=this;this.clearGrid(),null!==this.currentShape&&this.currentShape.points.forEach(function(e){var a=createRectangle(e.x,e.y,t.currentShape.color);t.currentShape.sprites.push(a),stage.addChild(a)})},GameObject.prototype.clearGrid=function(){null!==this.currentShape&&this.currentShape.sprites.forEach(function(t){stage.removeChild(t)})},GameObject.prototype.gameTick=function(){null!==this.currentShape&&this.currentShape.incrementShapePosition(0,1)},GameObject.prototype.checkForRowCompletion=function(){for(var t=0,e=this.gameHeight-1;e>=0;--e){for(var a=0;a<this.gameWidth;++a)1==this.gameGrid[a][e]&&t++;t===this.gameWidth&&this.clearRow(e),t=0}},GameObject.prototype.clearRow=function(t){for(var e=0;e<this.gameWidth;++e)this.gameGrid[e][t]=!1,stage.removeChild(this.landedShapeSprites[e][t]),this.landedShapeSprites[e][t]=null,this.landedShapeSpritesColors[e][t]=-1;this.moveRowsDown(t)},GameObject.prototype.moveRowsDown=function(t){for(var e=t-1;e>=0;--e)for(var a=0;a<this.gameWidth;++a)if(10!=this.landedShapeSprites[a][e]&&this.landedShapeSprites[a][e]){var i=this.findNextAvaiilableDropPosition(a,e+1),o=(this.landedShapeSprites[a][e].position.x,this.landedShapeSprites[a][e].position.y,this.landedShapeSpritesColors[a][e]);this.gameGrid[a][i]=!0;var r=createRectangle(a,i,o);this.landedShapeSprites[a][i]=r,this.landedShapeSpritesColors[a][i]=o,stage.addChild(r),this.gameGrid[a][e]=!1,stage.removeChild(this.landedShapeSprites[a][e]),this.landedShapeSprites[a][e]=null,this.landedShapeSpritesColors[a][e]=0}},GameObject.prototype.findNextAvaiilableDropPosition=function(t,e){for(var a=e;a<this.gameHeight;++a)if(!this.landedShapeSprites[t][a])return e},GameObject.prototype.onShapeLanded=function(){var t=this;this.currentShape.points.forEach(function(e){t.gameGrid[e.x][e.y]=!0;var a=createRectangle(e.x,e.y,t.currentShape.color);t.landedShapeSprites[e.x][e.y]=a,t.landedShapeSpritesColors[e.x][e.y]=t.currentShape.color,stage.addChild(a)}),this.currentShape.sprites.forEach(function(t){stage.removeChild(t)}),this.currentShape=null;var e=Math.floor(7*Math.random()+1);switch(e){case 1:this.addShape(new TShape(this));break;case 2:this.addShape(new OShape(this));break;case 3:this.addShape(new IShape(this));break;case 4:this.addShape(new SShape(this));break;case 5:this.addShape(new ZShape(this));break;case 6:this.addShape(new LShape(this));break;case 7:this.addShape(new JShape(this))}};var stage=new PIXI.Stage(16777215),FRAME_INTERVAL=1e3;!function(){"use strict";function t(){requestAnimFrame(t),o.renderShapes(),Date.now()>=r+FRAME_INTERVAL&&(r=Date.now(),o.gameTick()),o.checkForRowCompletion(),e.render(stage)}var e=PIXI.autoDetectRenderer(800,600),a=new PIXI.Text("TetriJS",{font:"50px Franklin Gothic",fill:"white",stroke:"black",strokeThickness:5});a.position.x=230,stage.addChild(a);var i=new PIXI.Text("Programming by: Daniel Lowman\nLanguage Used: JavaScript\nLibraries Used: PIXI.js\nBuilt using: NPM, Yeoman, Jasmine & Gulp",{font:"16px Franklin Gothic",fill:"black",stroke:"black",strokeThickness:0});i.position.x=238,i.position.y=50,stage.addChild(i);var o=new GameObject(10,22);o.initGameGrid(),o.addShape(new TShape(o)),o.renderShapes(),document.body.appendChild(e.view),requestAnimFrame(t);var r=Date.now(),h=37,n=39,s=38,p=40;$(document).keydown(function(t){if(0!=FRAME_INTERVAL)switch(t.which){case h:o.currentShape.incrementShapePosition(-1,0),t.preventDefault();break;case n:o.currentShape.incrementShapePosition(1,0),t.preventDefault();break;case s:o.currentShape.rotateShape(),t.preventDefault();break;case p:FRAME_INTERVAL=0,t.preventDefault()}})}();